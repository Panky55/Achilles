#ifndef HELPERS_H
#define HELPERS_H

#include <Achilles.h>
#include <utils/log.h>
#include <stdio.h>
#include <stdint.h>
#include <CoreFoundation/CoreFoundation.h>

// All of these are gaster functions, definitions and structures

#define MAX_BLOCK_SIZE 0x50
#define ARM_16K_TT_L2_SIZE 0x2000000U

typedef struct {
	uint64_t func, arg;
} callback_t;

// ******************************************************
// Function: generateUSBROPCallbacks()
//
// Purpose: Generates callbacks for the ROP chain used in the checkm8 exploit
//
// Parameters:
//      uint8_t *buffer: the buffer to write the callbacks to
//      uint64_t address: the address of the function to call
//      callback_t *callbacks: the callbacks to generate
//      size_t callbackCount: the number of elements in the callbacks array
//
// Returns:
//      size_t: the size of the generated callbacks
size_t generateUSBROPCallbacks(uint8_t *buffer, uint64_t address, callback_t *callbacks, size_t callbackCount);

#endif // HELPERS_H