.PHONY: payloads

CC ?= clang

payloads:
	@mkdir -p obj
	@mkdir -p bins
	@mkdir -p headers
	@as -arch arm64 src/payload_A9.S -o obj/payload_A9.o
	@gobjcopy -O binary -j .text obj/payload_A9.o bins/payload_A9.bin
	@xxd -iC bins/payload_A9.bin > headers/payload_A9.h
	@as -arch arm64 src/payload_notA9.S -o obj/payload_notA9.o
	@gobjcopy -O binary -j .text obj/payload_notA9.o bins/payload_notA9.bin
	@xxd -iC bins/payload_notA9.bin > headers/payload_notA9.h
	@as -arch arm64 src/payload_handle_checkm8_request.S -o obj/payload_handle_checkm8_request.o
	@gobjcopy -O binary -j .text obj/payload_handle_checkm8_request.o bins/payload_handle_checkm8_request.bin
	@xxd -iC bins/payload_handle_checkm8_request.bin > headers/payload_handle_checkm8_request.h
	@$(RM) -r obj
	@$(RM) -r bins