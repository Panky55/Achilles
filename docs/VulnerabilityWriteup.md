# How does one checkm8?

## Introduction
This is my analysis and writeup of the vulnerabilities exploited in the checkm8 BootROM exploit. I wrote this in order to help me gain a better understanding of the vulnerability so that I could design my own strategy for exploitation and write my own implementation of the exploit. The checkm8 exploit relies on a couple of vulnerabilities:
* The main use-after-free (not patched until A14)
* The memory leak (patched in A12)
The memory leak is essential in order to exploit the use-after-free because it allows us to deterministically craft the heap in order to allow the exploit to work. The patching of said memory leak in the A12 and A13 BootROMs is what prevents checkm8 from being exploited on these later SoCs.

Before we start, there are some important resources that I used to help me understand the exploit:
* [This technical analysis of checkm8](https://habr.com/en/companies/dsec/articles/472762/) by [a1exdandy](https://twitter.com/a1exdandy)
* [This presentation about checkra1n's implementation](https://papers.put.as/papers/ios/2019/LucaPOC.pdf) by [Luca Todesco](https://twitter.com/qwertyoruiopz)
* [This vulnerability writeup](https://gist.github.com/littlelailo/42c6a11d31877f98531f6d30444f59c4) by [littlelailo](https://twitter.com/littlelailo)
* [ipwndfu](https://github/Axi0mX/ipwndfu) by [axi0mX](https://twitter.com/axi0mX)
* [gaster](https://github.com/0x7FF/gaster) by [0x7FF](https://github.com/0x7FF)
* The leaked iBoot/BootROM source codes - not linked  here for obvious reasons
* [securerom.fun](https://securerom.fun) for their collection of BootROM dumps that I reverse engineered

Throughout this writeup, any code examples will be taken from the pseudocode generated from the BootROM dump reverse-engineering process for legal reasons, but the corresponding functions can also be easily found within the leaked iBoot/BootROM source codes.

## DFU initialisation